"use strict";function lineDistance(a,b){var c=0,d=0;return c=Math.abs(a.x-b.x),c*=c,d=Math.abs(a.y-b.y),d*=d,Math.sqrt(c+d)}var wKey,aKey,sKey,dKey,bKey,shiftKey,Player=function(a){this.game=a,this.sprite=null,this.transfer=!1,this.alive=!0,this.tilex=0,this.tiley=0,this.lives=3,this.harvesting=!1,this.harvestTime=0,this.chopSound=1,this.diedToBear=!1,this.diedToSkunk=!1,this.game.time.events.onPlayerDeath=new Phaser.Signal};Player.prototype={preload:function(){this.game.load.atlasJSONHash("characters","assets/img/spritesheets/characters.png","assets/img/spritesheets/characters.json")},create:function(a,b){this.transfer=!1,this.cursor=this.game.input.keyboard.createCursorKeys(),wKey=this.game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=this.game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=this.game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=this.game.input.keyboard.addKey(Phaser.Keyboard.D),bKey=this.game.input.keyboard.addKey(Phaser.Keyboard.B),shiftKey=this.game.input.keyboard.addKey(Phaser.Keyboard.SHIFT),this.sprite=this.game.add.sprite(this.tilex,this.tiley,"characters",a),this.sprite.anchor.setTo(.5,.5),this.game.physics.p2.enable(this.sprite),this.sprite.body.fixedRotation=!0,this.sprite.body.clearShapes(),this.sprite.body.addRectangle(20,20,-1,7),this.sprite.direction=b,this.sprite.animations.add("idledown",["sam00.png"]),this.sprite.animations.add("idleleft",["sam04.png"]),this.sprite.animations.add("idleright",["sam08.png"]),this.sprite.animations.add("idleup",["sam12.png"]),this.sprite.animations.add("right",["sam09.png","sam10.png","sam11.png","sam08.png"],7,!0,!1),this.sprite.animations.add("down",["sam01.png","sam02.png","sam03.png","sam00.png"],7,!0,!1),this.sprite.animations.add("up",["sam13.png","sam14.png","sam15.png","sam12.png"],7,!0,!1),this.sprite.animations.add("left",["sam05.png","sam06.png","sam07.png","sam04.png"],7,!0,!1),this.sprite.animations.add("runright",["sam09.png","sam10.png","sam11.png","sam08.png"],15,!0,!1),this.sprite.animations.add("rundown",["sam01.png","sam02.png","sam03.png","sam00.png"],15,!0,!1),this.sprite.animations.add("runup",["sam13.png","sam14.png","sam15.png","sam12.png"],15,!0,!1),this.sprite.animations.add("runleft",["sam05.png","sam06.png","sam07.png","sam04.png"],15,!0,!1),this.sprite.animations.add("chopright",["sam_chop16.png","sam_chop17.png","sam_chop18.png","sam_chop19.png","sam_chop20.png","sam_chop21.png","sam_chop22.png","sam_chop16.png"],8,!1,!1),this.sprite.animations.add("chopdown",["sam_chop00.png","sam_chop01.png","sam_chop02.png","sam_chop03.png","sam_chop04.png","sam_chop05.png","sam_chop06.png","sam_chop00.png"],8,!1,!1),this.sprite.animations.add("chopup",["sam_chop08.png","sam_chop09.png","sam_chop10.png","sam_chop11.png","sam_chop12.png","sam_chop13.png","sam_chop14.png","sam_chop08.png"],8,!1,!1),this.sprite.animations.add("chopleft",["sam_chop24.png","sam_chop25.png","sam_chop26.png","sam_chop27.png","sam_chop28.png","sam_chop29.png","sam_chop30.png","sam_chop24.png"],8,!1,!1)},update:function(){this.harvesting?(this.harvestTime+=1,this.harvestTime>50&&(this.harvesting=!1)):this.movements()},movements:function(){this.sprite.body.velocity.x=0,this.sprite.body.velocity.y=0;var a=shiftKey.isDown||this.run?275:100;dialogue.hidden&&(this.cursor.left.isDown||aKey.isDown||this.moveLeft)?(this.sprite.body.velocity.x=-a,this.sprite.direction="left",this.sprite.animations.play("left")):dialogue.hidden&&(this.cursor.right.isDown||dKey.isDown||this.moveRight)?(this.sprite.body.velocity.x=a,this.sprite.direction="right",this.sprite.animations.play("right")):dialogue.hidden&&(this.cursor.up.isDown||wKey.isDown||this.moveUp)?(this.sprite.body.velocity.y=-a,this.sprite.direction="up",this.sprite.animations.play("up")):dialogue.hidden&&(this.cursor.down.isDown||sKey.isDown||this.moveDown)?(this.sprite.body.velocity.y=a,this.sprite.direction="down",this.sprite.animations.play("down")):"up"===this.sprite.direction?this.sprite.animations.play("idleup"):"down"===this.sprite.direction?this.sprite.animations.play("idledown"):"right"===this.sprite.direction?this.sprite.animations.play("idleright"):"left"===this.sprite.direction&&this.sprite.animations.play("idleleft")},harvest:function(){if(!this.harvesting){switch(this.harvestTime=0,this.harvesting=!0,this.sprite.direction){case"left":this.sprite.animations.play("chopleft");break;case"right":this.sprite.animations.play("chopright");break;case"up":this.sprite.animations.play("chopup");break;case"down":this.sprite.animations.play("chopdown")}this.game.time.events.add(Phaser.Timer.SECOND,function(){this.harvesting=!1},this)}},loseLife:function(){BasicGame.lives--,this.sprite.kill(),this.game.time.events.onPlayerDeath.dispatch(this)}};var Npc=function(a,b,c,d,e){this.game=a,this.sprite=this.game.add.sprite(tileSize*b,tileSize*c,"characters",d),this.sprite.anchor.setTo(.5,.5),this.game.physics.p2.enable(this.sprite),this.sprite.body.kinematic=!0,this.sprite.body.clearShapes(),this.sprite.body.addRectangle(16,1,0,10),this.script=e.split("*"),this.spoke=!1};Npc.prototype=Object.create(Phaser.Sprite.prototype),Npc.prototype.interact=function(){return lineDistance(player.sprite,this.sprite)<30&&(this.spoke===!1?(dialogue.show(this,this.script),this.spoke=!0):dialogue.show(this,new Array("",this.script[this.script.length-1])),!0)},Npc.prototype.constructor=Npc;var Skunk=function(a,b,c,d){this.game=a,this.skunkNum=d,this.speed=50,this.distanceToPlayer=0,this.direction="left",this.isIdle=!0,this.sprite=this.game.add.sprite(tileSize*b,tileSize*c,"creatures","skunk00.png"),this.game.physics.p2.enable(this.sprite),this.sprite.body.fixedRotation=!0,this.sprite.body.clearShapes(),this.sprite.body.addRectangle(24,15,0,0),this.sprite.animations.add("idleleft",["skunk00.png"]),this.sprite.animations.add("idleright",["skunk05.png"]),this.sprite.animations.add("idleup",["skunk15.png"]),this.sprite.animations.add("idledown",["skunk10.png"]),this.sprite.animations.add("right",["skunk05.png","skunk06.png","skunk07.png","skunk08.png","skunk09.png"],7,!0,!1),this.sprite.animations.add("up",["skunk15.png","skunk16.png","skunk17.png","skunk18.png","skunk19.png"],7,!0),this.sprite.animations.add("left",["skunk00.png","skunk01.png","skunk02.png","skunk03.png","skunk04.png"],7,!0),this.sprite.animations.add("down",["skunk10.png","skunk11.png","skunk12.png","skunk13.png","skunk14.png"],7,!0)};Skunk.prototype=Object.create(Phaser.Sprite.prototype),Skunk.prototype.constructor=Skunk,Skunk.prototype.chase=function(){var a=Math.atan2(player.sprite.y-this.sprite.y,player.sprite.x-this.sprite.x);a>-2.5&&a<-.5?("up"!==this.direction&&(this.sprite.body.velocity.x=0,this.sprite.body.velocity.y=0),this.direction="up"):a>2.5||a<-2.5?("left"!==this.direction&&(this.sprite.body.velocity.x=0,this.sprite.body.velocity.y=0),this.direction="left"):a>-.5&&a<.5?("right"!==this.direction&&(this.sprite.body.velocity.x=0,this.sprite.body.velocity.y=0),this.direction="right"):a>.5&&a<2.5&&("down"!==this.direction&&(this.sprite.body.velocity.x=0,this.sprite.body.velocity.y=0),this.direction="down"),"left"===this.direction?this.sprite.animations.play("left"):"up"===this.direction?this.sprite.animations.play("up"):"right"===this.direction?this.sprite.animations.play("right"):"down"===this.direction&&this.sprite.animations.play("down"),this.sprite.body.force.x=Math.cos(a)*this.speed,this.sprite.body.force.y=Math.sin(a)*this.speed},Skunk.prototype.attackPlayer=function(){player.loseLife()},Skunk.prototype.idle=function(){this.isIdle||("left"===this.direction?this.sprite.animations.play("idleleft"):"right"===this.direction?this.sprite.animations.play("idleright"):"up"===this.direction?this.sprite.animations.play("idleup"):"down"===this.direction&&this.sprite.animations.play("idledown"),this.sprite.body.velocity.x=0,this.sprite.body.velocity.y=0,this.isIdle=!0)},Skunk.prototype.update=function(){this.distanceToPlayer=lineDistance(this.sprite,player.sprite),this.distanceToPlayer<=30&&player.sprite.alive?this.attackPlayer():this.distanceToPlayer>30&&this.distanceToPlayer<250?(this.chase(),this.isIdle=!1):this.idle()};var Bear=function(a,b,c){this.game=a,this.isIdle=!0,this.sprite=this.game.add.sprite(tileSize*b,tileSize*c,"creatures","bear00.png"),this.game.physics.p2.enable(this.sprite),this.sprite.body.fixedRotation=!0,this.sprite.body.kinematic=!0,this.sprite.body.clearShapes(),this.sprite.body.addRectangle(24,15,0,0),this.sprite.animations.add("idle",["bear01.png","bear03.png","bear04.png","bear03.png","bear04.png","bear03.png","bear04.png","bear03.png"],1.5,!0,!1),this.sprite.animations.add("alert",["bear00.png"]),this.sprite.animations.play("idle")};Bear.prototype=Object.create(Phaser.Sprite.prototype),Bear.prototype.constructor=Bear,Bear.prototype.idle=function(){this.sprite.animations.play("idle")},Bear.prototype.alert=function(){this.sprite.animations.play("alert")},Bear.prototype.attackPlayer=function(){player.diedToBear=!0,player.loseLife()},Bear.prototype.update=function(){this.distanceToPlayer=lineDistance(this.sprite,player.sprite),this.distanceToPlayer<50&&player.sprite.alive?this.attackPlayer():this.distanceToPlayer<150?this.alert():this.idle()};var Tree=function(a,b,c,d,e){this.game=a,this.harvested=!1,this.treeNum=d,this.treeLife=e,this.line="*You don't have an axe.*Instead you punch the tree.*Kapow!*OUCH!",this.script=this.line.split("*"),this.sprite=this.game.add.sprite(tileSize*b,tileSize*c,"objects","harvest_tree.png"),this.sprite.anchor.setTo(.5,.5),this.game.physics.p2.enable(this.sprite),this.sprite.body.fixedRotation=!0,this.sprite.body.kinematic=!0,this.sprite.body.clearShapes(),this.sprite.body.addRectangle(20,10,0,20),this.sprite.animations.add("chopped",["treestump.png"])};Tree.prototype=Object.create(Phaser.Sprite.prototype),Tree.prototype.constructor=Tree,Tree.prototype.interact=function(){return this.distance=lineDistance(player.sprite,this.sprite),BasicGame.haveAxe&&this.distance<30&&!player.harvesting?(player.harvest(),this.game.time.events.add(Phaser.Timer.SECOND,this.harvest,this),!0):this.distance<30&&!player.harvesting&&(this.punchTree(),!0)},Tree.prototype.punchTree=function(){dialogue.show(this,this.script)},Tree.prototype.harvest=function(){4===this.treeLife&&BasicGame.chop1.play("",0,1,!1),3===this.treeLife&&BasicGame.chop2.play("",0,1,!1),2===this.treeLife&&BasicGame.chop3.play("",0,1,!1),1===this.treeLife&&BasicGame.chop4.play("",0,1,!1),this.loseLife()},Tree.prototype.loseLife=function(){this.treeLife--,this.treeLife<=0&&(this.harvested=!0,BasicGame.wood++,localStorage.setItem("wood",BasicGame.wood),this.sprite.animations.play("chopped"),this.sprite.body.kinematic=!1,this.sprite.body.clearShapes(),this.sprite.body.addRectangle(20,10,0,0),this.sprite.body.y+=24,this.sprite.body.kinematic=!0),null!==localStorage.getItem("treeSpawns")&&(BasicGame.treeSpawns[this.treeNum]=this.treeLife,localStorage.setItem("treeSpawns",JSON.stringify(BasicGame.treeSpawns)))};var GopherHole=function(a,b,c){this.game=a,Phaser.Sprite.call(this,a,b,c,"objects","gopher_hole00.png"),this.game.physics.p2.enable(this),this.body.fixedRotation=!0,this.body.kinematic=!0,this.body.clearShapes(),this.body.addRectangle(8,1,0,-6)};GopherHole.prototype=Object.create(Phaser.Sprite.prototype),GopherHole.prototype.constructor=GopherHole,GopherHole.prototype.killPlayer=function(){player.diedToHole=!0,player.loseLife()},GopherHole.prototype.update=function(){this.distanceToPlayer=lineDistance(this,player.sprite),this.distanceToPlayer<30&&(this.angle=Math.atan2(player.sprite.y-this.y,player.sprite.x-this.x),this.angle>-2.5&&this.angle<-.5?this.distanceToPlayer<25&&player.sprite.alive&&this.killPlayer():this.angle>2.5||this.angle<-2.5?this.distanceToPlayer<8&&player.sprite.alive&&this.killPlayer():this.angle>-.5&&this.angle<.5?this.distanceToPlayer<8&&player.sprite.alive&&this.killPlayer():this.angle>.5&&this.angle<2.5&&this.distanceToPlayer<1&&player.sprite.alive&&this.killPlayer())};var Dialogue=function(a){this.game=a,this.hidden=!0,this.sprite=null,this.index=0,this.line="",this.text="",this.typing=!1,this.speaker=null};Dialogue.prototype={preload:function(){this.game.load.image("textbox","assets/img/spritesheets/textbox.png",tileSize,tileSize)},create:function(){this.sprite=this.game.add.sprite(0,704,"textbox"),this.sprite.width+=140,this.sprite.alpha=0,this.text=this.game.add.bitmapText(30,478,"textfont","",30)},show:function(a,b){if(!this.typing){this.speaker=a,this.content=b,this.typing=!0,this.hidden=!1,this.sprite.x=BasicGame.camera.x*BasicGame.w,this.sprite.y=BasicGame.camera.y*BasicGame.h+704,this.text.x=BasicGame.camera.x*BasicGame.w+30,this.text.y=BasicGame.camera.y*BasicGame.h+448+30,this.sprite.alpha=100;var c=this.game.add.tween(this.sprite).to({x:BasicGame.camera.x*BasicGame.w,y:BasicGame.camera.y*BasicGame.h+448},250);c.start(),c.onComplete.add(function(){this.nextLine()},this)}},hide:function(){if(this.hidden!==!0){this.text.setText(""),this.line="",this.index=0;var a=this.game.add.tween(this.sprite).to({x:BasicGame.camera.x*BasicGame.w,y:BasicGame.camera.y*BasicGame.h+704},250);a.start(),a.onComplete.add(function(){this.hidden=!0,this.sprite.alpha=0},this)}},nextLine:function(){this.index++,this.index<this.content.length?(this.line="",this.game.time.events.repeat(80,this.content[this.index].length+1,this.updateLine,this)):(this.typing=!1,this.speaker=null,this.text.setText(this.line+" *"))},updateLine:function(){this.line.length<this.content[this.index].length?(this.line=this.content[this.index].substr(0,this.line.length+1),this.text.setText(this.line)):this.game.time.events.add(2*Phaser.Timer.SECOND,this.nextLine,this)}};var flipScreen,tileSize=8,_rows=80,_cols=120,player,dialogue,spaceKey,BasicGame={w:tileSize*_cols,h:tileSize*_rows,lastLocation:"level1",level:1,lives:3,camera:{x:0,y:0}};null===localStorage.getItem("lastLocation")&&(BasicGame.lastLocation="level1",localStorage.setItem("lastLocation","level1")),null===localStorage.getItem("haveAxe")?(BasicGame.haveAxe=!1,localStorage.setItem("haveAxe",!1)):BasicGame.haveAxe=JSON.parse(localStorage.getItem("haveAxe")),null===localStorage.getItem("checkpoint")?(BasicGame.checkpoint=1,localStorage.setItem("checkpoint","1")):BasicGame.checkpoint=JSON.parse(localStorage.getItem("checkpoint")),null===localStorage.getItem("finished")?(BasicGame.finished=!1,localStorage.setItem("finished",!1)):BasicGame.finished=JSON.parse(localStorage.getItem("finished")),null===localStorage.getItem("lives")?(BasicGame.lives=3,localStorage.setItem("lives",BasicGame.lives)):BasicGame.lives=JSON.parse(localStorage.getItem("lives")),null===localStorage.getItem("playerX")&&localStorage.setItem("playerX",0),null===localStorage.getItem("playerY")&&localStorage.setItem("playerY",0),null===localStorage.getItem("pelts")?(BasicGame.pelts=0,localStorage.setItem("pelts",0)):BasicGame.pelts=JSON.parse(localStorage.getItem("pelts")),null===localStorage.getItem("wood")?(BasicGame.wood=0,localStorage.setItem("wood",0)):BasicGame.wood=JSON.parse(localStorage.getItem("wood")),null===localStorage.getItem("skunkSpawns")?(BasicGame.skunkSpawns=[!0,!0,!0,!0,!0,!0,!0],localStorage.setItem("skunkSpawns",JSON.stringify(BasicGame.skunkSpawns))):BasicGame.skunkSpawns=JSON.parse(localStorage.getItem("skunkSpawns")),null===localStorage.getItem("treeSpawns")?(BasicGame.treeSpawns=[4,4,4,4,4,4],localStorage.setItem("treeSpawns",JSON.stringify(BasicGame.treeSpawns))):BasicGame.treeSpawns=JSON.parse(localStorage.getItem("treeSpawns")),BasicGame.Boot=function(a){this.game=a},BasicGame.Boot.prototype={preload:function(){this.game.load.image("loading","assets/img/preloader/loading.png"),this.game.load.image("load_progress_bar_dark","assets/img/preloader/progress_bar_bg.png"),this.game.load.image("load_progress_bar","assets/img/preloader/progress_bar_fg.png"),this.game.load.image("orientation","assets/img/spritesheets/orientation.png")},create:function(){this.game.device.desktop||(this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.setMinMax(480,260,1024,768),this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.forceOrientation(!0,!1),this.game.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation,this),this.game.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation,this),this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT),this.game.stage.smoothed=!1,this.game.state.start("preload")},enterIncorrectOrientation:function(){flipScreen=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"orientation"),flipScreen.fixedToCamera=!0,flipScreen.anchor.x=.5,flipScreen.anchor.y=.5,BasicGame.orientated=!1,this.game.paused=!0},leaveIncorrectOrientation:function(){flipScreen.kill(),BasicGame.orientated=!0,this.game.paused=!1}},BasicGame.Preload=function(a){this.game=a,this.preloadBar=null},BasicGame.Preload.prototype={preload:function(){this.displayLoadScreen(),this.loadAssets()},displayLoadScreen:function(){this.preloadBar=this.add.sprite(BasicGame.w/2-200,BasicGame.h/2-100,"loading"),this.barBg=this.add.sprite(BasicGame.w/2-10,BasicGame.h/2-10,"load_progress_bar_dark"),this.barBg.anchor.setTo(.5,.5),this.bar=this.add.sprite(BasicGame.w/2-202,BasicGame.h/2-10,"load_progress_bar"),this.bar.anchor.setTo(0,.5),this.load.setPreloadSprite(this.bar),this.load.onLoadComplete.addOnce(this.onLoadComplete,this)},loadAssets:function(){this.game.load.atlasJSONHash("creatures","assets/img/spritesheets/creatures.png","assets/img/spritesheets/creatures.json"),this.game.load.atlasJSONHash("objects","assets/img/spritesheets/objects.png","assets/img/spritesheets/objects.json"),this.game.load.tilemap("level1","assets/img/levels/level1.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.tilemap("level2","assets/img/levels/level2.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.tilemap("level3","assets/img/levels/level3.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.tilemap("level4","assets/img/levels/level4.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.tilemap("level5","assets/img/levels/level5.json",null,Phaser.Tilemap.TILED_JSON),this.game.load.image("tiles","assets/img/spritesheets/tilesheet.png"),this.game.load.spritesheet("button","assets/img/spritesheets/DifficultyButton.png",80,20),this.game.load.image("openscreen","assets/img/spritesheets/openscreen.png"),this.game.load.image("win","assets/img/spritesheets/wingame.png"),this.game.load.image("pause","assets/img/spritesheets/pause_screen.png"),this.game.load.image("bearlose","assets/img/spritesheets/beardead.png"),this.game.load.image("skunklose","assets/img/spritesheets/dead_with_skunks.jpg"),this.game.load.image("holelose","assets/img/spritesheets/boy_hurt_leg.jpg"),this.game.load.image("fullScreen","assets/img/spritesheets/fullscreen.png"),this.game.load.image("leftButton","assets/img/spritesheets/leftbutton.png"),this.game.load.image("rightButton","assets/img/spritesheets/rightbutton.png"),this.game.load.image("upButton","assets/img/spritesheets/upbutton.png"),this.game.load.image("downButton","assets/img/spritesheets/downbutton.png"),this.game.load.image("aButton","assets/img/spritesheets/abutton.png"),this.game.load.image("bButton","assets/img/spritesheets/bbutton.png"),this.game.load.image("helpButton","assets/img/spritesheets/helpbutton.png"),this.game.load.audio("soundtrack",["assets/audio/ericmusic_loop.mp3"]),this.game.load.audio("bush1",["assets/audio/bush_rustle1.ogg","assets/audio/bush_rustle1.mp3"]),this.game.load.audio("bush2",["assets/audio/bush_rustle2.ogg","assets/audio/bush_rustle2.mp3"]),this.game.load.audio("skunkgrowl",["assets/audio/skunkgrowl.ogg","assets/audio/skunkgrowl.mp3"]),this.game.load.audio("woodchop1",["assets/audio/woodchop1.ogg","assets/audio/woodchop1.mp3"]),this.game.load.audio("woodchop2",["assets/audio/woodchop2.ogg","assets/audio/woodchop2.mp3"]),this.game.load.audio("woodchop3",["assets/audio/woodchop3.ogg","assets/audio/woodchop3.mp3"]),this.game.load.audio("woodchop4",["assets/audio/woodchop_final.ogg","assets/audio/woodchop_final.mp3"]),this.game.load.bitmapFont("textfont","assets/img/fonts/font.png","assets/img/fonts/font.xml"),dialogue=new Dialogue(this.game),dialogue.preload(),player=new Player(this.game),player.preload(),spaceKey=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)},update:function(){this.soundDecoded()&&this.ready&&this.game.state.start("openscreen")},onLoadComplete:function(){this.ready=!0},soundDecoded:function(){return this.game.cache.checkImageKey("helpButton")&&this.game.cache.isSoundDecoded("bush1")&&this.game.cache.isSoundDecoded("bush2")&&this.game.cache.isSoundDecoded("skunkgrowl")&&this.game.cache.isSoundDecoded("woodchop1")&&this.game.cache.isSoundDecoded("woodchop2")&&this.game.cache.isSoundDecoded("woodchop3")&&this.game.cache.isSoundDecoded("woodchop4")&&this.game.cache.isSoundDecoded("soundtrack")}},BasicGame.lose=function(a){this.game=a},BasicGame.lose.prototype={preload:function(){},create:function(){this.game.stage.backgroundColor="#000000";var a=this.game.add.sprite(SCREEN_WIDTH/2,SCREEN_HEIGHT/2,"lose");a.anchor.x=.5,a.anchor.y=.5},update:function(){(this.game.input.keyboard.isDown(Phaser.Keyboard.ENTER)||this.game.input.pointer1.isDown)&&setTimeout("window.location.href='index.html'",200)}},BasicGame.restart=function(a){this.game=a},BasicGame.restart.prototype={preload:function(){},create:function(){var a={font:"25px Arial",fill:"#ffffff",align:"center"};this.game.stage.backgroundColor="#000000";var b=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"skunklose");this.text1=this.game.add.text(BasicGame.w/2-100,70,"You ran out of energy!",a),this.text2=this.game.add.text(BasicGame.w/2-150,90,"You must try again the next day.",a),this.text3=this.game.add.text(BasicGame.w/2-150,BasicGame.h/2+200,"Press Enter or Return to Restart.",a),b.anchor.x=.5,b.anchor.y=.5},update:function(){(this.game.input.keyboard.isDown(Phaser.Keyboard.ENTER)||this.game.input.activePointer.isDown)&&(BasicGame.reset=!0,this.game.state.start("level1"))}},BasicGame.win=function(a){this.game=a},BasicGame.win.prototype={preload:function(){},create:function(){var a={font:"25px Arial",fill:"#ffffff",align:"center"};this.game.stage.backgroundColor="#000000",this.menu=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"win"),this.text=this.game.add.text(BasicGame.w/2-150,BasicGame.h/2+200,"Press Enter or Return to Continue.",a),this.menu.anchor.x=.5,this.menu.anchor.y=.5},update:function(){localStorage.removeItem("haveAxe"),localStorage.removeItem("checkpoint"),localStorage.removeItem("finished"),localStorage.removeItem("lives"),localStorage.removeItem("playerX"),localStorage.removeItem("playerY"),localStorage.removeItem("pelts"),localStorage.removeItem("wood"),localStorage.removeItem("skunkSpawns"),localStorage.removeItem("treeSpawns"),(this.game.input.keyboard.isDown(Phaser.Keyboard.ENTER)||this.game.input.activePointer.isDown)&&setTimeout(function(){window.location.href="./index.html"},200)}},BasicGame.Open=function(a){this.game=a,BasicGame.lastLocation=localStorage.getItem("lastLocation")},BasicGame.Open.prototype={preload:function(){},create:function(){this.menu=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"openscreen"),this.menu.scale.set(2),this.menu.anchor.x=.5,this.menu.anchor.y=.5,this.style={font:"25px Arial",fill:"#ffffff",align:"center"},this.ready=!1,this.text1=this.game.add.text(BasicGame.w/4+50,BasicGame.h/4,"Choose the difficulty of the game",this.style),this.button1=this.game.add.button(BasicGame.w/2-250,BasicGame.h/2,"button",this.easyDifficulty,this,0,1,2),this.button1.scale.set(2,1.5),this.button1.smoothed=!1,this.buttonText1=this.game.add.bitmapText(BasicGame.w/2-250,BasicGame.h/2+7,"textfont","Easy",16),this.buttonText1.x+=this.button1.width/2-this.buttonText1.textWidth/2,this.button2=this.game.add.button(BasicGame.w/2+50,BasicGame.h/2,"button",this.hardDifficulty,this,0,1,2),this.button2.scale.set(2,1.5),this.button2.smoothed=!1,this.buttonText2=this.game.add.bitmapText(BasicGame.w/2+50,BasicGame.h/2+7,"textfont","Hard",16),this.buttonText2.x+=this.button2.width/2-this.buttonText2.textWidth/2},update:function(){(this.game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR)||this.game.input.keyboard.isDown(Phaser.Keyboard.ENTER)||this.game.input.activePointer.isDown)&&this.ready&&(this.game.state.start(BasicGame.lastLocation),BasicGame.music=this.game.add.sound("soundtrack"),BasicGame.music.volume=.1,BasicGame.music.play("",0,1,!0),BasicGame.growl=this.game.add.audio("skunkgrowl"),BasicGame.growl.volume=.5,BasicGame.bush1=this.game.add.audio("bush1"),BasicGame.bush1.volume=.5,BasicGame.bush2=this.game.add.audio("bush2"),BasicGame.bush2.volume=.5,BasicGame.chop1=this.game.add.sound("woodchop1"),BasicGame.chop2=this.game.add.sound("woodchop2"),BasicGame.chop3=this.game.add.sound("woodchop3"),BasicGame.chop4=this.game.add.sound("woodchop4"))},makeButton:function(a,b,c){var d=this.game.add.button(b,c,"button",this.click,this,0,1,2);d.scale.set(2,1.5),d.smoothed=!1;var e=this.game.add.bitmapText(b,c+7,"textfont",a,16);e.x+=d.width/2-e.textWidth/2},easyDifficulty:function(){this.text1.destroy(),this.buttonText1.destroy(),this.buttonText2.destroy(),this.button1.destroy(),this.button2.destroy(),this.createInstructions(),BasicGame.difficulty="easy",this.game.time.events.add(2*Phaser.Timer.SECOND,this.startGame,this)},hardDifficulty:function(){this.text1.destroy(),this.buttonText1.destroy(),this.buttonText2.destroy(),this.button1.destroy(),this.button2.destroy(),this.createInstructions(),BasicGame.difficulty="hard",this.game.time.events.add(2*Phaser.Timer.SECOND,this.startGame,this)},startGame:function(){this.ready=!0},createInstructions:function(){this.game.device.desktop?(this.game.add.text(400,285,"INTERACT: Press space bar near person/object",this.style),this.game.add.text(400,310,"RUN: Hold shift key",this.style),this.game.add.text(400,335,"MOVE: Use arrow keys or W,A,S,D ",this.style),this.game.add.text(400,375,"Find your Uncle Don.",this.style),this.game.add.text(400,400,"He will tell you what you need.",this.style),this.game.add.text(300,430,"HIT THE SPACE BAR OR ENTER TO START GAME",this.style)):(this.game.add.text(400,355,"Find your Uncle Don.",this.style),this.game.add.text(400,375,"He will tell you what you need.",this.style),this.game.add.text(400,420,"Tap Screen to Start",this.style))}},BasicGame.level1=function(a){this.game=a},BasicGame.level1.prototype.preload=function(){BasicGame.lastLocation=localStorage.getItem("lastLocation"),localStorage.setItem("lastLocation","level1"),BasicGame.reset&&(BasicGame.lives=3),BasicGame.wood>5&&(BasicGame.finished=!0,localStorage.setItem("finished",!0))},BasicGame.level1.prototype.create=function(){if(this.game.physics.startSystem(Phaser.Physics.P2JS),this.game.physics.p2.setBoundsToWorld(!0,!0,!0,!0,!1),this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,this.pause=this.game.input.keyboard.addKey(Phaser.Keyboard.H),this.pause.onDown.add(this.togglePause,this),this.idevice=/(iP(hone|od|ad))/i.test(navigator.userAgent),!this.game.device.desktop){var a=this.game.add.button(95,BasicGame.h-119,"rightButton",null,this),b=this.game.add.button(0,BasicGame.h-119,"leftButton",null,this),c=this.game.add.button(48,BasicGame.h-150,"upButton",null,this),d=this.game.add.button(48,BasicGame.h-84,"downButton",null,this),e=this.game.add.button(BasicGame.w-58,BasicGame.h-58,"aButton",null,this),f=this.game.add.button(BasicGame.w-58,BasicGame.h-106,"bButton",null,this),g=this.game.add.button(BasicGame.w-100,0,"helpButton",null,this);if(!this.idevice)var h=this.game.add.button(BasicGame.w-58,0,"fullScreen",null,this);a.alpha=.3,b.alpha=.3,c.alpha=.3,d.alpha=.3,this.game.input.onDown.add(this.unpauseGame,this),a.events.onInputDown.add(function(){player.moveRight=!0,a.alpha=1}),b.events.onInputDown.add(function(){player.moveLeft=!0,b.alpha=1}),c.events.onInputDown.add(function(){player.moveUp=!0,c.alpha=1}),d.events.onInputDown.add(function(){player.moveDown=!0,d.alpha=1}),e.events.onInputDown.add(function(){player.interact=!0,e.alpha=.2}),f.events.onInputDown.add(function(){player.fire=!0,f.alpha=.2}),g.events.onInputDown.add(function(){this.togglePause()},this),this.idevice||h.events.onInputDown.add(this.gofull,this),a.events.onInputUp.add(function(){player.moveRight=!1,a.alpha=.3}),b.events.onInputUp.add(function(){player.moveLeft=!1,b.alpha=.3}),c.events.onInputUp.add(function(){player.moveUp=!1,c.alpha=.3}),d.events.onInputUp.add(function(){player.moveDown=!1,d.alpha=.3}),e.events.onInputUp.add(function(){player.interact=!1,e.alpha=1}),f.events.onInputUp.add(function(){player.fire=!1,f.alpha=1})}this.map=this.game.add.tilemap("level1"),this.map.addTilesetImage("tilesheet","tiles",8,8),this.mapCollision=this.map.createLayer("collision"),this.background=this.map.createLayer("main"),this.background.resizeWorld(),this.midground=this.map.createLayer("bottoms"),this.map.setCollision(1,!0,"collision"),this.npcs=this.game.add.group(),this.lines={don:{1:"*Your cousin lost an axe in the woods.*You need that axe to harvest wood.*Be careful though!*There are dangerous animals.*Defend yourself with 'B'.*If you need any help talk to me again.",2:"*Have you found your cousin's axe?*It's in the NORTH side of the woods.*You need it to cut down trees.*If you see any bears, Don't bother them!",3:"*You need to harvest the right trees.*They look different from the normal trees.*Stand next to the tree and INTERACT.",4:"*You got all the wood?*That's Great!*Take them back to my house*and I'll start on that cart."}},this.physics.p2.convertTilemap(this.map,this.mapCollision),this.gramps=new Npc(this.game,109,33,"grandfather.png",this.lines.don[BasicGame.checkpoint]),this.exitPoints=this.game.add.group(),this.exitPoint1=this.game.add.sprite(119*tileSize+7,40*tileSize,"objects","levelchange.png"),this.exitPoint1.scale.setTo(1,9*tileSize),this.exitPoint1.destination="level2",this.exitPoint2=this.game.add.sprite(23*tileSize,30*tileSize,"objects","levelchange.png"),this.exitPoint2.destination="win",this.exitPoints.add(this.exitPoint1),this.exitPoints.add(this.exitPoint2),this.createPlayer(),this.npcs.add(player.sprite),this.npcs.add(this.gramps.sprite),this.foreground=this.map.createLayer("tops"),dialogue.create();var i={font:"25px Arial",fill:"#ffffff",align:"center"};this.pause_label=this.game.add.text(BasicGame.w-100,0,"H:Help",i),this.pause_screen=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"pause"),this.pause_screen.anchor.setTo(.5,.5),this.pause_screen.kill(),this.text2=this.game.add.text(BasicGame.w/4,BasicGame.h/2-60,"MOVE: Use arrow keys or w,a,s,d",i),this.text2.kill(),this.text3=this.game.add.text(BasicGame.w/4,BasicGame.h/2-20,"ARROWS: Press B to fire an Arrow.",i),this.text3.kill(),this.game.device.desktop?(this.text1=this.game.add.text(BasicGame.w/4,BasicGame.h/2-100,"RUN: Hold the shift key.",i),this.text1.kill(),this.text4=this.game.add.text(BasicGame.w/4,BasicGame.h/2+20,"INTERACT: Press Spacebar next to person/object.",i),this.text4.kill(),this.text6=this.game.add.text(BasicGame.w/4,BasicGame.h/2+125,"Press H to Resume",i),this.text6.kill()):(this.text1=this.game.add.text(BasicGame.w/4,BasicGame.h/2-100,"",i),this.text1.kill(),this.text4=this.game.add.text(BasicGame.w/4,BasicGame.h/2+20,"INTERACT: Press A next to person/object.",i),this.text4.kill(),this.text6=this.game.add.text(BasicGame.w/4,BasicGame.h/2+125,"Tap anywhere to continue.",i),this.text6.kill()),this.text5=this.game.add.text(BasicGame.w/4,BasicGame.h/2+80,"Interact with your Uncle for instructions.",i),this.text5.kill(),this.liveSprites=this.game.add.group();for(var j=0;j<BasicGame.lives;j++)this.liveSprites.create(22*j,0,"objects","lifesprite.png");this.woodText=this.game.add.text(12*tileSize,0,"Wood: "+BasicGame.wood,i),this.peltsText=this.game.add.text(26*tileSize,0,"Pelts: "+BasicGame.pelts,i),this.hud=this.game.add.sprite(0,0),this.hud.fixedToCamera=!0,this.hud.addChild(this.liveSprites),this.hud.addChild(this.woodText),
this.hud.addChild(this.peltsText),this.hud.addChild(this.pause_label),this.game.device.desktop||(this.pause_label.kill(),this.hud.addChild(a),this.hud.addChild(b),this.hud.addChild(c),this.hud.addChild(d),this.hud.addChild(e),this.hud.addChild(f),this.hud.addChild(g),this.idevice||this.hud.addChild(h)),this.hud.cameraOffset.x=10,this.hud.cameraOffset.y=10},BasicGame.level1.prototype.update=function(){this.woodText.setText("Wood: "+BasicGame.wood),this.peltsText.setText("Pelts: "+BasicGame.pelts),this.exitPoints.forEach(function(a){var b=a.getBounds(),c=player.sprite.getBounds();Phaser.Rectangle.intersects(b,c)&&("win"!==a.destination&&BasicGame.checkpoint>1||"win"===a.destination&&BasicGame.finished)&&(player.transfer=!0,this.game.state.start(a.destination))},this),(spaceKey.isDown||player.interact)&&dialogue.hidden&&(BasicGame.haveAxe?BasicGame.finished?(BasicGame.checkpoint=4,localStorage.setItem("checkpoint","4"),this.updateCharacterLines(),this.gramps.interact()):(BasicGame.checkpoint=3,localStorage.setItem("checkpoint","3"),this.updateCharacterLines(),this.gramps.interact()):this.gramps.interact()&&(BasicGame.checkpoint=2,localStorage.setItem("checkpoint","2"),this.updateCharacterLines())),!spaceKey.isDown&&!player.interact||dialogue.typing||dialogue.hidden||dialogue.hide(),player.update(),this.npcs.sort("y",Phaser.Group.SORT_ASCENDING)},BasicGame.level1.prototype.createPlayer=function(){"level1"===BasicGame.lastLocation?(player.tilex=23*tileSize,player.tiley=30*tileSize,player.create("sam08.png","down")):(player.tilex=118*tileSize-2,player.tiley=41*tileSize,player.create("sam04.png","left"))},BasicGame.level1.prototype.updateCharacterLines=function(){this.updating||(this.updating=!0,this.gramps.script=this.lines.don[BasicGame.checkpoint].split("*"),this.gramps.spoke=!1,this.updating=!1)},BasicGame.level1.prototype.gofull=function(){this.game.scale.isFullScreen?this.game.scale.stopFullScreen():this.game.scale.startFullScreen(!1)},BasicGame.level1.prototype.togglePause=function(){this.game.paused=!this.game.paused,this.game.paused?(this.pause_screen.revive(),this.text1.revive(),this.text2.revive(),this.text3.revive(),this.text4.revive(),this.text5.revive(),this.text6.revive()):(this.pause_screen.kill(),this.text1.kill(),this.text2.kill(),this.text3.kill(),this.text4.kill(),this.text5.kill(),this.text6.kill())},BasicGame.level1.prototype.unpauseGame=function(a){this.game.paused&&this.togglePause()},BasicGame.level2=function(a){this.game=a},BasicGame.level2.prototype.preload=function(){BasicGame.lastLocation=localStorage.getItem("lastLocation"),localStorage.setItem("lastLocation","level2"),this.playerx=parseInt(localStorage.getItem("playerX")),this.playery=parseInt(localStorage.getItem("playerY"))},BasicGame.level2.prototype.create=function(){if(this.game.physics.startSystem(Phaser.Physics.P2JS),this.game.physics.p2.setBoundsToWorld(!0,!0,!0,!0,!1),this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,this.pause=this.game.input.keyboard.addKey(Phaser.Keyboard.H),this.pause.onDown.add(this.togglePause,this),this.idevice=/(iPhone|iPod|iPad)/i.test(navigator.userAgent),!this.game.device.desktop){var a=this.game.add.button(95,BasicGame.h-119,"rightButton",null,this),b=this.game.add.button(0,BasicGame.h-119,"leftButton",null,this),c=this.game.add.button(48,BasicGame.h-150,"upButton",null,this),d=this.game.add.button(48,BasicGame.h-84,"downButton",null,this),e=this.game.add.button(BasicGame.w-58,BasicGame.h-58,"aButton",null,this),f=this.game.add.button(BasicGame.w-58,BasicGame.h-106,"bButton",null,this),g=this.game.add.button(BasicGame.w-100,0,"helpButton",null,this);if(!this.idevice)var h=this.game.add.button(BasicGame.w-58,0,"fullScreen",null,this);a.alpha=.3,b.alpha=.3,c.alpha=.3,d.alpha=.3,this.game.input.onDown.add(this.unpauseGame,this),a.events.onInputDown.add(function(){player.moveRight=!0,a.alpha=1}),b.events.onInputDown.add(function(){player.moveLeft=!0,b.alpha=1}),c.events.onInputDown.add(function(){player.moveUp=!0,c.alpha=1}),d.events.onInputDown.add(function(){player.moveDown=!0,d.alpha=1}),e.events.onInputDown.add(function(){player.interact=!0,e.alpha=.2}),f.events.onInputDown.add(function(){player.fire=!0,f.alpha=.2}),g.events.onInputDown.add(function(){this.togglePause()},this),this.idevice||h.events.onInputDown.add(this.gofull,this),a.events.onInputUp.add(function(){player.moveRight=!1,a.alpha=.5}),b.events.onInputUp.add(function(){player.moveLeft=!1,b.alpha=.5}),c.events.onInputUp.add(function(){player.moveUp=!1,c.alpha=.5}),d.events.onInputUp.add(function(){player.moveDown=!1,d.alpha=.5}),e.events.onInputUp.add(function(){player.interact=!1,e.alpha=1}),f.events.onInputUp.add(function(){player.fire=!1,f.alpha=1})}this.map=this.game.add.tilemap("level2"),this.map.addTilesetImage("tilesheet","tiles",8,8),this.mapCollision=this.map.createLayer("collision"),this.background=this.map.createLayer("main"),this.background.resizeWorld(),this.midground=this.map.createLayer("driedforest"),this.midground=this.map.createLayer("bottoms"),this.map.setCollision(1,!0,"collision"),this.physics.p2.convertTilemap(this.map,this.mapCollision),BasicGame.skunkSpawns[0]&&(this.skunk=new Skunk(this.game,9*tileSize,4*tileSize+3,0)),this.bears=[],BasicGame.wood<4?(this.bearsExist=!0,this.bears[0]=new Bear(this.game,105,53),this.bears[1]=new Bear(this.game,110,60),this.bears[2]=new Bear(this.game,105,67)):this.bearsExist=!1,this.exitPoints=this.game.add.group(),this.exitPoint1=this.game.add.sprite(0*tileSize,38*tileSize,"objects","levelchange.png"),this.exitPoint1.scale.setTo(1,9*tileSize),this.exitPoint1.destination="level1",this.exitPoint2=this.game.add.sprite(60*tileSize,0*tileSize,"objects","levelchange.png"),this.exitPoint2.scale.setTo(28*tileSize,1),this.exitPoint2.destination="level3",this.exitPoint3=this.game.add.sprite(119*tileSize,48*tileSize,"objects","levelchange.png"),this.exitPoint3.scale.setTo(1,25*tileSize),this.exitPoint3.destination="level4",this.exitPoint4=this.game.add.sprite(58*tileSize,79*tileSize,"objects","levelchange.png"),this.exitPoint4.scale.setTo(18*tileSize,1),this.exitPoint4.destination="level5",this.exitPoints.add(this.exitPoint1),this.exitPoints.add(this.exitPoint2),this.exitPoints.add(this.exitPoint3),this.exitPoints.add(this.exitPoint4),BasicGame.arrowTime=0,BasicGame.arrows=this.game.add.sprite(0,0,"objects","projectile_x.png"),BasicGame.arrows.outOfBoundsKill=!0,BasicGame.arrows.checkWorldBounds=!0,this.game.physics.p2.enable(BasicGame.arrows),BasicGame.arrows.body.clearShapes(),BasicGame.arrows.body.addRectangle(18,5,0,0),BasicGame.arrows.kill(),this.createPlayer(),this.foreground=this.map.createLayer("lowerforest"),this.foreground2=this.map.createLayer("forest"),dialogue.create(),this.bearlose=null,this.bearlose=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"bearlose"),this.bearlose.anchor.x=.5,this.bearlose.anchor.y=.5,this.bearlose.kill();var i={font:"25px Arial",fill:"#ffffff",align:"center"};this.pause_label=this.game.add.text(BasicGame.w-100,0,"H:Help",i),this.pause_screen=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"pause"),this.pause_screen.anchor.setTo(.5,.5),this.pause_screen.kill(),this.game.device.desktop?(this.text1=this.game.add.text(BasicGame.w/4,BasicGame.h/2-140,"RUN: Hold the shift key.",i),this.text1.kill(),this.text6=this.game.add.text(BasicGame.w/4,BasicGame.h/2+125,"Press H to Resume",i),this.text6.kill()):(this.text1=this.game.add.text(BasicGame.w/4,BasicGame.h/2-140,"",i),this.text1.kill(),this.text6=this.game.add.text(BasicGame.w/4,BasicGame.h/2+125,"Tap anywhere to continue.",i),this.text6.kill()),this.text2=this.game.add.text(BasicGame.w/4,BasicGame.h/2-100,"MOVE: Use arrow keys or w,a,s,d",i),this.text2.kill(),this.text3=this.game.add.text(BasicGame.w/4,BasicGame.h/2-60,"ARROWS: Press B to fire an Arrow.",i),this.text3.kill(),this.text4=this.game.add.text(BasicGame.w/4,BasicGame.h/2+40,"Lost? Talk to Uncle Don.",i),this.text4.kill(),this.text5=this.game.add.text(BasicGame.w/4,BasicGame.h/2+80,"Don't let the skunks catch you!",i),this.text5.kill(),BasicGame.liveSprites=null,BasicGame.liveSprites=this.game.add.group();for(var j=0;j<BasicGame.lives;j++)BasicGame.liveSprites.create(22*j,0,"objects","lifesprite.png");this.woodText=this.game.add.text(12*tileSize,0,"Wood: "+BasicGame.wood,i),this.peltsText=this.game.add.text(26*tileSize,0,"Pelts: "+BasicGame.pelts,i),this.hud=this.game.add.sprite(0,0),this.hud.fixedToCamera=!0,this.hud.addChild(BasicGame.liveSprites),this.hud.addChild(this.woodText),this.hud.addChild(this.peltsText),this.hud.addChild(this.pause_label),this.game.device.desktop||(this.pause_label.kill(),this.hud.addChild(a),this.hud.addChild(b),this.hud.addChild(c),this.hud.addChild(d),this.hud.addChild(e),this.hud.addChild(f),this.hud.addChild(g),this.idevice||this.hud.addChild(h)),this.hud.cameraOffset.x=10,this.hud.cameraOffset.y=10},BasicGame.level2.prototype.update=function(){this.woodText.setText("Wood: "+BasicGame.wood),this.peltsText.setText("Pelts: "+BasicGame.pelts),this.game.time.events.onPlayerDeath.addOnce(this.loseLife,this),BasicGame.lives<=0&&this.game.state.start("restart"),dialogue.hidden&&(bKey.isDown||player.fire)&&!player.harvesting&&this.fire(),this.exitPoints.forEach(function(a){var b=a.getBounds(),c=player.sprite.getBounds();Phaser.Rectangle.intersects(b,c)&&(localStorage.setItem("playerX",player.sprite.x),localStorage.setItem("playerY",player.sprite.y),this.game.time.events.onPlayerDeath.removeAll(),player.transfer=!0,this.game.state.start(a.destination))},this),player.update(),this.skunk&&(this.skunk.update(),BasicGame.skunkSpawns[this.skunk.skunkNum]&&Phaser.Rectangle.intersects(BasicGame.arrows.getBounds(),this.skunk.sprite.getBounds())&&(BasicGame.skunkSpawns[this.skunk.skunkNum]=!1,localStorage.setItem("skunkSpawns",JSON.stringify(BasicGame.skunkSpawns)),BasicGame.arrows.kill(),this.skunk.sprite.destroy(),this.skunk=null,BasicGame.pelts++,localStorage.setItem("pelts",BasicGame.pelts))),this.bearsExist&&(this.bears[0].update(),this.bears[1].update(),this.bears[2].update())},BasicGame.level2.prototype.loseLife=function(){BasicGame.liveSprites.getFirstAlive().kill(),player.diedToBear&&(player.diedToBear=!1,this.bearlose.revive(),this.game.time.events.add(2*Phaser.Timer.SECOND,this.killBearScreen,this)),this.game.time.events.add(2*Phaser.Timer.SECOND,this.createPlayer,this)},BasicGame.level2.prototype.killBearScreen=function(){this.bearlose.kill()},BasicGame.level2.prototype.createPlayer=function(){"level1"===BasicGame.lastLocation||"level2"===BasicGame.lastLocation?(player.tilex=2*tileSize+2,player.tiley=38*tileSize,player.transfer||null===player.sprite?player.create("sam08.png","right"):player.sprite.reset(player.tilex,player.tiley)):"level3"===BasicGame.lastLocation?(player.tilex=this.playerx,player.tiley=3*tileSize+2,player.transfer||null===player.sprite?player.create("sam00.png","down"):player.sprite.reset(player.tilex,player.tiley)):"level4"===BasicGame.lastLocation?(player.tilex=117*tileSize-2,player.tiley=this.playery,player.transfer||null===player.sprite?player.create("sam04.png","left"):player.sprite.reset(player.tilex,player.tiley)):"level5"===BasicGame.lastLocation&&(player.tilex=this.playerx,player.tiley=75*tileSize,player.transfer||null===player.sprite?player.create("sam04.png","up"):player.sprite.reset(player.tilex,player.tiley))},BasicGame.level2.prototype.fire=function(){if(this.game.time.now>BasicGame.arrowTime){switch(this.game.time.events.add(Phaser.Timer.SECOND,function(){BasicGame.arrows.kill()},this),player.sprite.direction){case"left":BasicGame.arrows.reset(player.sprite.x-20,player.sprite.y),BasicGame.arrows.body.angle=180,BasicGame.arrows.body.velocity.x=-400,BasicGame.arrows.body.velocity.y=0;break;case"right":BasicGame.arrows.reset(player.sprite.x+18,player.sprite.y),BasicGame.arrows.body.angle=0,BasicGame.arrows.body.velocity.x=400,BasicGame.arrows.body.velocity.y=0;break;case"up":BasicGame.arrows.reset(player.sprite.x,player.sprite.y-20),BasicGame.arrows.body.angle=-90,BasicGame.arrows.body.velocity.x=0,BasicGame.arrows.body.velocity.y=-400;break;case"down":BasicGame.arrows.reset(player.sprite.x,player.sprite.y+25),BasicGame.arrows.body.angle=90,BasicGame.arrows.body.velocity.x=0,BasicGame.arrows.body.velocity.y=400}BasicGame.arrowTime=this.game.time.now+1e3}},BasicGame.level2.prototype.gofull=function(){this.game.scale.isFullScreen?this.game.scale.stopFullScreen():this.game.scale.startFullScreen(!1)},BasicGame.level2.prototype.togglePause=function(){this.game.paused=!this.game.paused,this.game.paused?(this.pause_screen.revive(),this.text1.revive(),this.text2.revive(),this.text3.revive(),this.text4.revive(),this.text5.revive(),this.text6.revive()):(this.pause_screen.kill(),this.text1.kill(),this.text2.kill(),this.text3.kill(),this.text4.kill(),this.text5.kill(),this.text6.kill())},BasicGame.level2.prototype.unpauseGame=function(a){this.game.paused&&this.togglePause()},BasicGame.level3=function(a){this.game=a},BasicGame.level3.prototype.preload=function(){BasicGame.lastLocation=localStorage.getItem("lastLocation"),localStorage.setItem("lastLocation","level3"),this.playerx=parseInt(localStorage.getItem("playerX")),this.skunkLoc=[{x:10,y:20},{x:110,y:20}]},BasicGame.level3.prototype.create=function(){if(this.game.physics.startSystem(Phaser.Physics.P2JS),this.game.physics.p2.setBoundsToWorld(!0,!0,!0,!0,!1),this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,this.pause=this.game.input.keyboard.addKey(Phaser.Keyboard.H),this.pause.onDown.add(this.togglePause,this),this.idevice=/(iPhone|iPod|iPad)/i.test(navigator.userAgent),!this.game.device.desktop){var a=this.game.add.button(95,BasicGame.h-119,"rightButton",null,this),b=this.game.add.button(0,BasicGame.h-119,"leftButton",null,this),c=this.game.add.button(48,BasicGame.h-150,"upButton",null,this),d=this.game.add.button(48,BasicGame.h-84,"downButton",null,this),e=this.game.add.button(BasicGame.w-58,BasicGame.h-58,"aButton",null,this),f=this.game.add.button(BasicGame.w-58,BasicGame.h-106,"bButton",null,this),g=this.game.add.button(BasicGame.w-100,0,"helpButton",null,this);if(!this.idevice)var h=this.game.add.button(BasicGame.w-58,0,"fullScreen",null,this);a.alpha=.3,b.alpha=.3,c.alpha=.3,d.alpha=.3,this.game.input.onDown.add(this.unpauseGame,this),a.events.onInputDown.add(function(){player.moveRight=!0,a.alpha=1}),b.events.onInputDown.add(function(){player.moveLeft=!0,b.alpha=1}),c.events.onInputDown.add(function(){player.moveUp=!0,c.alpha=1}),d.events.onInputDown.add(function(){player.moveDown=!0,d.alpha=1}),e.events.onInputDown.add(function(){player.talk=!0,player.interact=!0,e.alpha=.2}),f.events.onInputDown.add(function(){player.fire=!0,f.alpha=.2}),g.events.onInputDown.add(function(){this.togglePause()},this),this.idevice||h.events.onInputDown.add(this.gofull,this),a.events.onInputUp.add(function(){player.moveRight=!1,a.alpha=.2}),b.events.onInputUp.add(function(){player.moveLeft=!1,b.alpha=.2}),c.events.onInputUp.add(function(){player.moveUp=!1,c.alpha=.2}),d.events.onInputUp.add(function(){player.moveDown=!1,d.alpha=.2}),e.events.onInputUp.add(function(){player.interact=!1,e.alpha=1}),f.events.onInputUp.add(function(){player.fire=!1,f.alpha=1})}this.map=this.game.add.tilemap("level3"),this.map.addTilesetImage("tilesheet","tiles",8,8),this.mapCollision=this.map.createLayer("collision"),this.background=this.map.createLayer("main"),this.background.resizeWorld(),this.midground=this.map.createLayer("lowerforest"),this.map.setCollision(1,!0,"collision"),this.physics.p2.convertTilemap(this.map,this.mapCollision),this.skunks=[];for(var i=0;i<2;i++)BasicGame.skunkSpawns[i+1]&&(this.skunks[i]=new Skunk(this.game,this.skunkLoc[i].x,this.skunkLoc[i].y,i+1));this.exitPoints=this.game.add.group(),this.exitPoint1=this.game.add.sprite(56*tileSize,79*tileSize,"objects","levelchange.png"),this.exitPoint1.scale.setTo(36*tileSize,1),this.exitPoint1.destination="level2",this.exitPoints.add(this.exitPoint1),BasicGame.arrowTime=0,BasicGame.arrows=this.game.add.sprite(0,0,"objects","projectile_x.png"),BasicGame.arrows.outOfBoundsKill=!0,BasicGame.arrows.checkWorldBounds=!0,this.game.physics.p2.enable(BasicGame.arrows),BasicGame.arrows.body.clearShapes(),BasicGame.arrows.body.addRectangle(18,5,0,0),BasicGame.arrows.kill(),this.createPlayer(),this.tree1=new Tree(this.game,110,10,0,BasicGame.treeSpawns[0]),this.tree2=new Tree(this.game,9,10,1,BasicGame.treeSpawns[1]),BasicGame.treeSpawns[0]<=0&&(this.tree1.harvested=!0,this.tree1.sprite.animations.play("chopped"),this.tree1.sprite.body.kinematic=!1,this.tree1.sprite.body.clearShapes(),this.tree1.sprite.body.addRectangle(20,10,0,0),this.tree1.sprite.body.y+=24,this.tree1.sprite.body.kinematic=!0),BasicGame.treeSpawns[1]<=0&&(this.tree2.harvested=!0,this.tree2.sprite.animations.play("chopped"),this.tree2.sprite.body.kinematic=!1,this.tree2.sprite.body.clearShapes(),this.tree2.sprite.body.addRectangle(20,10,0,0),this.tree2.sprite.body.y+=24,this.tree2.sprite.body.kinematic=!0),this.stump=this.game.add.sprite(110*tileSize,60*tileSize,"objects","treestump.png"),this.game.physics.p2.enable(this.stump),this.stump.body.kinematic=!0,this.stump.body.clearShapes(),this.stump.body.addRectangle(20,1,0,0),this.overlapGroup=this.game.add.group(),this.overlapGroup.add(player.sprite),this.overlapGroup.add(this.tree1.sprite),this.overlapGroup.add(this.tree2.sprite),this.overlapGroup.add(this.stump),this.overlapGroup.add(BasicGame.arrows),BasicGame.haveAxe||(this.axe=this.game.add.sprite(108*tileSize,58*tileSize-1,"objects","idle_axe.png")),this.foreground=this.map.createLayer("forest"),this.foreground2=this.map.createLayer("topforest"),dialogue.create();var j={font:"25px Arial",fill:"#ffffff",align:"center"};this.pause_label=this.game.add.text(BasicGame.w-100,0,"H:Help",j),this.pause_screen=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"pause"),this.pause_screen.anchor.setTo(.5,.5),this.pause_screen.kill(),this.game.device.desktop?(this.text1=this.game.add.text(BasicGame.w/4,BasicGame.h/2-100,"RUN: Hold the shift key.",j),this.text1.kill(),this.text7=this.game.add.text(BasicGame.w/4,BasicGame.h/2+125,"Press H to Resume",j),this.text7.kill()):(this.text1=this.game.add.text(BasicGame.w/4,BasicGame.h/2-100,"",j),this.text1.kill(),this.text7=this.game.add.text(BasicGame.w/4,BasicGame.h/2+125,"Tap anywhere to continue.",j),this.text7.kill()),this.text2=this.game.add.text(BasicGame.w/4,BasicGame.h/2-60,"MOVE: Use arrow keys or w,a,s,d",j),this.text2.kill(),this.text3=this.game.add.text(BasicGame.w/4,BasicGame.h/2-20,"ARROWS: Press B to fire an Arrow.",j),this.text3.kill(),this.text4=this.game.add.text(BasicGame.w/4,BasicGame.h/2+20,"Harvest: Stand next to tree and INTERACT.",j),this.text4.kill(),this.text5=this.game.add.text(BasicGame.w/4,BasicGame.h/2+50,"The tree will fall after 4 chops.",j),this.text5.kill(),this.text6=this.game.add.text(BasicGame.w/4,BasicGame.h/2+85,"Don't let the skunks catch you!",j),this.text6.kill(),BasicGame.liveSprites=null,BasicGame.liveSprites=this.game.add.group();for(var i=0;i<BasicGame.lives;i++)BasicGame.liveSprites.create(22*i,0,"objects","lifesprite.png");this.woodText=this.game.add.text(12*tileSize,0,"Wood: "+BasicGame.wood,j),this.peltsText=this.game.add.text(26*tileSize,0,"Pelts: "+BasicGame.pelts,j),this.hud=this.game.add.sprite(0,0),this.hud.fixedToCamera=!0,this.hud.addChild(BasicGame.liveSprites),this.hud.addChild(this.woodText),this.hud.addChild(this.peltsText),this.hud.addChild(this.pause_label),this.game.device.desktop||(this.pause_label.kill(),this.hud.addChild(a),this.hud.addChild(b),this.hud.addChild(c),this.hud.addChild(d),this.hud.addChild(e),this.hud.addChild(f),this.hud.addChild(g),this.idevice||this.hud.addChild(h)),this.hud.cameraOffset.x=10,this.hud.cameraOffset.y=10},BasicGame.level3.prototype.update=function(){this.woodText.setText("Wood: "+BasicGame.wood),this.peltsText.setText("Pelts: "+BasicGame.pelts),this.game.time.events.onPlayerDeath.addOnce(this.loseLife,this),BasicGame.lives<=0&&this.game.state.start("restart"),dialogue.hidden&&(bKey.isDown||player.fire)&&!player.harvesting&&this.fire(),this.exitPoints.forEach(function(a){var b=a.getBounds(),c=player.sprite.getBounds();Phaser.Rectangle.intersects(b,c)&&(localStorage.setItem("playerX",player.sprite.x),localStorage.setItem("playerY",player.sprite.y),player.transfer=!0,this.game.time.events.onPlayerDeath.removeAll(),this.game.state.start(a.destination))},this),(spaceKey.isDown||player.interact)&&dialogue.hidden&&(this.tree1.harvested||this.tree1.interact(),this.tree2.harvested||this.tree2.interact()),!spaceKey.isDown&&!player.interact||dialogue.typing||dialogue.hidden||dialogue.hide(),!BasicGame.haveAxe&&Phaser.Rectangle.intersects(this.axe.getBounds(),player.sprite.getBounds())&&(this.axe.destroy(),BasicGame.haveAxe=!0,localStorage.setItem("haveAxe",!0),BasicGame.checkpoint=3,localStorage.setItem("checkpoint",BasicGame.checkpoint)),player.update();for(var a=0;a<this.skunks.length;a++)this.skunks[a]&&(this.skunks[a].update(),BasicGame.skunkSpawns[this.skunks[a].skunkNum]&&Phaser.Rectangle.intersects(BasicGame.arrows.getBounds(),this.skunks[a].sprite.getBounds())&&(BasicGame.skunkSpawns[this.skunks[a].skunkNum]=!1,localStorage.setItem("skunkSpawns",JSON.stringify(BasicGame.skunkSpawns)),BasicGame.arrows.kill(),this.skunks[a].sprite.destroy(),this.skunks[a]=null,BasicGame.pelts++,localStorage.setItem("pelts",BasicGame.pelts)));this.overlapGroup.sort("y",Phaser.Group.SORT_ASCENDING)},BasicGame.level3.prototype.loseLife=function(){BasicGame.liveSprites.getFirstAlive().kill(),this.game.time.events.add(2*Phaser.Timer.SECOND,this.createPlayer,this)},BasicGame.level3.prototype.createPlayer=function(){"level2"!==BasicGame.lastLocation&&"level3"!==BasicGame.lastLocation||(player.tilex=this.playerx,player.tiley=76*tileSize-2,player.transfer||null===player.sprite?player.create("sam08.png","up"):player.sprite.reset(player.tilex,player.tiley))},BasicGame.level3.prototype.fire=function(){if(this.game.time.now>BasicGame.arrowTime){switch(this.game.time.events.add(Phaser.Timer.SECOND,function(){BasicGame.arrows.kill()},this),player.sprite.direction){case"left":BasicGame.arrows.reset(player.sprite.x-20,player.sprite.y),BasicGame.arrows.body.angle=180,BasicGame.arrows.body.velocity.x=-400,BasicGame.arrows.body.velocity.y=0;break;case"right":BasicGame.arrows.reset(player.sprite.x+18,player.sprite.y),BasicGame.arrows.body.angle=0,BasicGame.arrows.body.velocity.x=400,BasicGame.arrows.body.velocity.y=0;break;case"up":BasicGame.arrows.reset(player.sprite.x,player.sprite.y-20),BasicGame.arrows.body.angle=-90,BasicGame.arrows.body.velocity.x=0,BasicGame.arrows.body.velocity.y=-400;break;case"down":BasicGame.arrows.reset(player.sprite.x,player.sprite.y+25),BasicGame.arrows.body.angle=90,BasicGame.arrows.body.velocity.x=0,BasicGame.arrows.body.velocity.y=400}BasicGame.arrowTime=this.game.time.now+1e3}},BasicGame.level3.prototype.gofull=function(){this.game.scale.isFullScreen?this.game.scale.stopFullScreen():this.game.scale.startFullScreen(!1)},BasicGame.level3.prototype.togglePause=function(){this.game.paused=!this.game.paused,this.game.paused?(this.pause_screen.revive(),this.text1.revive(),this.text2.revive(),this.text3.revive(),this.text4.revive(),this.text5.revive(),this.text6.revive(),this.text7.revive()):(this.pause_screen.kill(),this.text1.kill(),this.text2.kill(),this.text3.kill(),this.text4.kill(),this.text5.kill(),this.text6.kill(),this.text7.kill())},BasicGame.level3.prototype.unpauseGame=function(a){this.game.paused&&this.togglePause()},BasicGame.level4=function(a){this.game=a},BasicGame.level4.prototype.preload=function(){BasicGame.lastLocation=localStorage.getItem("lastLocation"),localStorage.setItem("lastLocation","level4"),this.playerx=parseInt(localStorage.getItem("playerX")),this.playery=parseInt(localStorage.getItem("playerY")),this.skunkLoc=[{x:90,y:7},{x:100,y:70}]},BasicGame.level4.prototype.create=function(){if(this.game.physics.startSystem(Phaser.Physics.P2JS),this.game.physics.p2.setBoundsToWorld(!0,!0,!0,!0,!1),this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,this.pause=this.game.input.keyboard.addKey(Phaser.Keyboard.H),this.pause.onDown.add(this.togglePause,this),this.idevice=/(iPhone|iPod|iPad)/i.test(navigator.userAgent),!this.game.device.desktop){var a=this.game.add.button(95,BasicGame.h-119,"rightButton",null,this),b=this.game.add.button(0,BasicGame.h-119,"leftButton",null,this),c=this.game.add.button(48,BasicGame.h-150,"upButton",null,this),d=this.game.add.button(48,BasicGame.h-84,"downButton",null,this),e=this.game.add.button(BasicGame.w-58,BasicGame.h-58,"aButton",null,this),f=this.game.add.button(BasicGame.w-58,BasicGame.h-106,"bButton",null,this),g=this.game.add.button(BasicGame.w-100,0,"helpButton",null,this);if(!this.idevice)var h=this.game.add.button(BasicGame.w-58,0,"fullScreen",null,this);a.alpha=.2,b.alpha=.2,c.alpha=.2,d.alpha=.2,this.game.input.onDown.add(this.unpauseGame,this),a.events.onInputDown.add(function(){player.moveRight=!0,a.alpha=1}),b.events.onInputDown.add(function(){player.moveLeft=!0,b.alpha=1}),c.events.onInputDown.add(function(){player.moveUp=!0,c.alpha=1}),d.events.onInputDown.add(function(){player.moveDown=!0,d.alpha=1}),e.events.onInputDown.add(function(){player.interact=!0,e.alpha=.2}),f.events.onInputDown.add(function(){player.fire=!0,f.alpha=.2}),g.events.onInputDown.add(function(){this.togglePause()},this),this.idevice||h.events.onInputDown.add(this.gofull,this),a.events.onInputUp.add(function(){player.moveRight=!1,a.alpha=.2}),b.events.onInputUp.add(function(){player.moveLeft=!1,b.alpha=.2}),c.events.onInputUp.add(function(){player.moveUp=!1,c.alpha=.2}),d.events.onInputUp.add(function(){player.moveDown=!1,d.alpha=.2}),e.events.onInputUp.add(function(){player.interact=!1,e.alpha=1}),f.events.onInputUp.add(function(){player.fire=!1,f.alpha=1})}this.map=this.game.add.tilemap("level4"),this.map.addTilesetImage("tilesheet","tiles",8,8),this.mapCollision=this.map.createLayer("collision"),this.background=this.map.createLayer("main"),this.background.resizeWorld(),this.midground=this.map.createLayer("mountains"),this.midground=this.map.createLayer("bottoms"),this.map.setCollision(1,!0,"collision"),this.physics.p2.convertTilemap(this.map,this.mapCollision),this.skunks=[];for(var i=0;i<2;i++)BasicGame.skunkSpawns[i+5]&&(this.skunks[i]=new Skunk(this.game,this.skunkLoc[i].x,this.skunkLoc[i].y,i+5));this.exitPoints=this.game.add.group(),this.exitPoint1=this.game.add.sprite(0*tileSize,47*tileSize,"objects","levelchange.png"),this.exitPoint1.scale.setTo(1,25*tileSize),this.exitPoint1.destination="level2",this.exitPoints.add(this.exitPoint1),BasicGame.arrowTime=0,BasicGame.arrows=this.game.add.sprite(0,0,"objects","projectile_x.png"),BasicGame.arrows.outOfBoundsKill=!0,BasicGame.arrows.checkWorldBounds=!0,this.game.physics.p2.enable(BasicGame.arrows),BasicGame.arrows.body.clearShapes(),BasicGame.arrows.body.addRectangle(18,5,0,0),BasicGame.arrows.kill(),this.createPlayer(),this.tree5=new Tree(this.game,108,65,4,BasicGame.treeSpawns[4]),this.tree6=new Tree(this.game,110,7,5,BasicGame.treeSpawns[5]),BasicGame.treeSpawns[4]<=0&&(this.tree5.harvested=!0,this.tree5.sprite.animations.play("chopped"),this.tree5.sprite.body.kinematic=!1,this.tree5.sprite.body.clearShapes(),this.tree5.sprite.body.addRectangle(20,10,0,0),this.tree5.sprite.body.y+=24,this.tree5.sprite.body.kinematic=!0),BasicGame.treeSpawns[5]<=0&&(this.tree6.harvested=!0,this.tree6.sprite.animations.play("chopped"),this.tree6.sprite.body.kinematic=!1,this.tree6.sprite.body.clearShapes(),this.tree6.sprite.body.addRectangle(20,10,0,0),this.tree6.sprite.body.y+=24,this.tree6.sprite.body.kinematic=!0),this.overlapGroup=this.game.add.group(),this.overlapGroup.add(player.sprite),this.overlapGroup.add(this.tree5.sprite),this.overlapGroup.add(this.tree6.sprite),this.overlapGroup.add(BasicGame.arrows),this.foreground=this.map.createLayer("mid"),this.foreground2=this.map.createLayer("top"),dialogue.create();var j={font:"25px Arial",fill:"#ffffff",align:"center"};this.pause_label=this.game.add.text(BasicGame.w-100,0,"H:Help",j),this.pause_screen=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"pause"),this.pause_screen.anchor.setTo(.5,.5),this.pause_screen.kill(),this.text1=this.game.add.text(BasicGame.w/4,BasicGame.h/2-100,"RUN: Hold the shift key.",j),this.text1.kill(),this.text2=this.game.add.text(BasicGame.w/4,BasicGame.h/2-60,"MOVE: Use arrow keys or w,a,s,d",j),this.text2.kill(),this.text3=this.game.add.text(BasicGame.w/4,BasicGame.h/2-20,"ARROWS: Press B to fire an Arrow.",j),this.text3.kill(),this.text4=this.game.add.text(BasicGame.w/4,BasicGame.h/2+20,"Harvest: Stand next to tree and press 'Spacebar'.",j),this.text4.kill(),this.text5=this.game.add.text(BasicGame.w/4,BasicGame.h/2+85,"Don't let the skunks catch you!",j),this.text5.kill(),this.text6=this.game.add.text(BasicGame.w/4,BasicGame.h/2+125,"Press H to Resume",j),this.text6.kill(),BasicGame.liveSprites=null,BasicGame.liveSprites=this.game.add.group();for(var i=0;i<BasicGame.lives;i++)BasicGame.liveSprites.create(22*i,0,"objects","lifesprite.png");this.woodText=this.game.add.text(12*tileSize,0,"Wood: "+BasicGame.wood,j),this.peltsText=this.game.add.text(26*tileSize,0,"Pelts: "+BasicGame.pelts,j),this.hud=this.game.add.sprite(0,0),this.hud.fixedToCamera=!0,this.hud.addChild(BasicGame.liveSprites),this.hud.addChild(this.woodText),this.hud.addChild(this.peltsText),this.hud.addChild(this.pause_label),this.game.device.desktop||(this.pause_label.kill(),this.hud.addChild(a),this.hud.addChild(b),this.hud.addChild(c),this.hud.addChild(d),this.hud.addChild(e),this.hud.addChild(f),this.hud.addChild(g),this.idevice||this.hud.addChild(h)),this.hud.cameraOffset.x=10,this.hud.cameraOffset.y=10},BasicGame.level4.prototype.update=function(){this.woodText.setText("Wood: "+BasicGame.wood),this.peltsText.setText("Pelts: "+BasicGame.pelts),this.game.time.events.onPlayerDeath.addOnce(this.loseLife,this),BasicGame.lives<=0&&this.game.state.start("restart"),dialogue.hidden&&(bKey.isDown||player.fire)&&!player.harvesting&&this.fire(),this.exitPoints.forEach(function(a){var b=a.getBounds(),c=player.sprite.getBounds();Phaser.Rectangle.intersects(b,c)&&(localStorage.setItem("playerX",player.sprite.x),localStorage.setItem("playerY",player.sprite.y),player.transfer=!0,this.game.time.events.onPlayerDeath.removeAll(),this.game.state.start(a.destination))},this),(spaceKey.isDown||player.interact)&&dialogue.hidden&&BasicGame.haveAxe&&(this.tree5.harvested||this.tree5.interact(),this.tree6.harvested||this.tree6.interact()),player.update();for(var a=0;a<this.skunks.length;a++)this.skunks[a]&&(this.skunks[a].update(),BasicGame.skunkSpawns[this.skunks[a].skunkNum]&&Phaser.Rectangle.intersects(BasicGame.arrows.getBounds(),this.skunks[a].sprite.getBounds())&&(BasicGame.skunkSpawns[this.skunks[a].skunkNum]=!1,localStorage.setItem("skunkSpawns",JSON.stringify(BasicGame.skunkSpawns)),BasicGame.arrows.kill(),this.skunks[a].sprite.destroy(),this.skunks[a]=null,BasicGame.pelts++,localStorage.setItem("pelts",BasicGame.pelts)));this.overlapGroup.sort("y",Phaser.Group.SORT_ASCENDING)},BasicGame.level4.prototype.loseLife=function(){BasicGame.liveSprites.getFirstAlive().kill(),this.game.time.events.add(2*Phaser.Timer.SECOND,this.createPlayer,this)},BasicGame.level4.prototype.createPlayer=function(){"level2"!==BasicGame.lastLocation&&"level4"!==BasicGame.lastLocation||(player.tilex=3*tileSize,player.tiley=this.playery,player.transfer||null===player.sprite?player.create("sam08.png","right"):player.sprite.reset(player.tilex,player.tiley))},BasicGame.level4.prototype.fire=function(){if(this.game.time.now>BasicGame.arrowTime){switch(this.game.time.events.add(Phaser.Timer.SECOND,function(){BasicGame.arrows.kill()},this),player.sprite.direction){case"left":BasicGame.arrows.reset(player.sprite.x-20,player.sprite.y),BasicGame.arrows.body.angle=180,BasicGame.arrows.body.velocity.x=-400,
BasicGame.arrows.body.velocity.y=0;break;case"right":BasicGame.arrows.reset(player.sprite.x+18,player.sprite.y),BasicGame.arrows.body.angle=0,BasicGame.arrows.body.velocity.x=400,BasicGame.arrows.body.velocity.y=0;break;case"up":BasicGame.arrows.reset(player.sprite.x,player.sprite.y-20),BasicGame.arrows.body.angle=-90,BasicGame.arrows.body.velocity.x=0,BasicGame.arrows.body.velocity.y=-400;break;case"down":BasicGame.arrows.reset(player.sprite.x,player.sprite.y+25),BasicGame.arrows.body.angle=90,BasicGame.arrows.body.velocity.x=0,BasicGame.arrows.body.velocity.y=400}BasicGame.arrowTime=this.game.time.now+1e3}},BasicGame.level4.prototype.gofull=function(){this.game.scale.isFullScreen?this.game.scale.stopFullScreen():this.game.scale.startFullScreen(!1)},BasicGame.level4.prototype.togglePause=function(){this.game.paused=!this.game.paused,this.game.paused?(this.pause_screen.revive(),this.text1.revive(),this.text2.revive(),this.text3.revive(),this.text4.revive(),this.text5.revive(),this.text6.revive()):(this.pause_screen.kill(),this.text1.kill(),this.text2.kill(),this.text3.kill(),this.text4.kill(),this.text5.kill(),this.text6.kill())},BasicGame.level4.prototype.unpauseGame=function(a){this.game.paused&&this.togglePause()},BasicGame.level5=function(a){this.game=a},BasicGame.level5.prototype.preload=function(){BasicGame.lastLocation=localStorage.getItem("lastLocation"),localStorage.setItem("lastLocation","level5"),this.playerx=parseInt(localStorage.getItem("playerX")),this.playery=parseInt(localStorage.getItem("playerY")),this.skunkLoc=[{x:14,y:70},{x:100,y:70}]},BasicGame.level5.prototype.create=function(){if(this.game.physics.startSystem(Phaser.Physics.P2JS),this.game.physics.p2.setBoundsToWorld(!0,!0,!0,!0,!1),this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.EXACT_FIT,this.pause=this.game.input.keyboard.addKey(Phaser.Keyboard.H),this.pause.onDown.add(this.togglePause,this),this.idevice=/(iPhone|iPod|iPad)/i.test(navigator.userAgent),!this.game.device.desktop){var a=this.game.add.button(95,BasicGame.h-119,"rightButton",null,this),b=this.game.add.button(0,BasicGame.h-119,"leftButton",null,this),c=this.game.add.button(48,BasicGame.h-150,"upButton",null,this),d=this.game.add.button(48,BasicGame.h-84,"downButton",null,this),e=this.game.add.button(BasicGame.w-58,BasicGame.h-58,"aButton",null,this),f=this.game.add.button(BasicGame.w-58,BasicGame.h-106,"bButton",null,this),g=this.game.add.button(BasicGame.w-100,0,"helpButton",null,this);if(!this.idevice)var h=this.game.add.button(BasicGame.w-58,0,"fullScreen",null,this);a.alpha=.4,b.alpha=.4,c.alpha=.4,d.alpha=.4,this.game.input.onDown.add(this.unpauseGame,this),a.events.onInputDown.add(function(){player.moveRight=!0,a.alpha=1}),b.events.onInputDown.add(function(){player.moveLeft=!0,b.alpha=1}),c.events.onInputDown.add(function(){player.moveUp=!0,c.alpha=1}),d.events.onInputDown.add(function(){player.moveDown=!0,d.alpha=1}),e.events.onInputDown.add(function(){player.interact=!0,e.alpha=.2}),f.events.onInputDown.add(function(){player.fire=!0,f.alpha=.2}),g.events.onInputDown.add(function(){this.togglePause()},this),this.idevice||h.events.onInputDown.add(this.gofull,this),a.events.onInputUp.add(function(){player.moveRight=!1,a.alpha=.2}),b.events.onInputUp.add(function(){player.moveLeft=!1,b.alpha=.2}),c.events.onInputUp.add(function(){player.moveUp=!1,c.alpha=.2}),d.events.onInputUp.add(function(){player.moveDown=!1,d.alpha=.2}),e.events.onInputUp.add(function(){player.interact=!1,e.alpha=1}),f.events.onInputUp.add(function(){player.fire=!1,f.alpha=1})}this.map=this.game.add.tilemap("level5"),this.map.addTilesetImage("tilesheet","tiles",8,8),this.mapCollision=this.map.createLayer("collision"),this.background=this.map.createLayer("main"),this.background.resizeWorld(),this.midground=this.map.createLayer("bottom"),this.map.setCollision(1,!0,"collision"),this.physics.p2.convertTilemap(this.map,this.mapCollision),this.gopherHoles=this.game.add.group(),"easy"===BasicGame.difficulty?this.map.createFromObjects("gopher holes easy",1,"objects","gopher_hole00.png",!0,!1,this.gopherHoles,GopherHole):"hard"===BasicGame.difficulty&&this.map.createFromObjects("gopher holes hard",1,"objects","gopher_hole00.png",!0,!1,this.gopherHoles,GopherHole),this.skunks=[];for(var i=0;i<2;i++)BasicGame.skunkSpawns[i+3]&&(this.skunks[i]=new Skunk(this.game,this.skunkLoc[i].x,this.skunkLoc[i].y,i+3));this.npcs=this.game.add.group(),this.tree3=new Tree(this.game,111,70,2,BasicGame.treeSpawns[2]),this.tree4=new Tree(this.game,7,70,3,BasicGame.treeSpawns[3]),BasicGame.treeSpawns[2]<=0&&(this.tree3.harvested=!0,this.tree3.sprite.animations.play("chopped"),this.tree3.sprite.body.kinematic=!1,this.tree3.sprite.body.clearShapes(),this.tree3.sprite.body.addRectangle(20,10,0,0),this.tree3.sprite.body.y+=24,this.tree3.sprite.body.kinematic=!0),BasicGame.treeSpawns[3]<=0&&(this.tree4.harvested=!0,this.tree4.sprite.animations.play("chopped"),this.tree4.sprite.body.kinematic=!1,this.tree4.sprite.body.clearShapes(),this.tree4.sprite.body.addRectangle(20,10,0,0),this.tree4.sprite.body.y+=24,this.tree4.sprite.body.kinematic=!0),this.lines={stranger:{2:"*I was traveling through the woods,*and I heard something in the bushes.*When I turned to see what it was*I fell in a gopher hole!",3:"*I'm resting my leg*I twisted my ankle when I fell on hole.*I think I saw a skunk in the bush*You should watch out for them.*They seem to be guarding the trees.",4:"*I'll be ok, I just need to rest.*I'll head back home before it gets dark."}},this.stranger=new Npc(this.game,61,20,"woundedtraveler.png",this.lines.stranger[BasicGame.checkpoint]),this.exitPoints=this.game.add.group(),this.exitPoint1=this.game.add.sprite(60*tileSize,0*tileSize,"objects","levelchange.png"),this.exitPoint1.scale.setTo(17*tileSize,1),this.exitPoint1.destination="level2",this.exitPoints.add(this.exitPoint1),BasicGame.arrowTime=0,BasicGame.arrows=this.game.add.sprite(0,0,"objects","projectile_x.png"),BasicGame.arrows.outOfBoundsKill=!0,BasicGame.arrows.checkWorldBounds=!0,this.game.physics.p2.enable(BasicGame.arrows),BasicGame.arrows.body.clearShapes(),BasicGame.arrows.body.addRectangle(18,5,0,0),BasicGame.arrows.kill(),this.createPlayer(),this.npcs.add(player.sprite),this.npcs.add(this.stranger.sprite),this.npcs.add(this.tree3.sprite),this.npcs.add(this.tree4.sprite),this.npcs.add(BasicGame.arrows),this.foreground=this.map.createLayer("mid"),this.foreground2=this.map.createLayer("top"),dialogue.create(),this.gopherLose=null,this.gopherLose=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"holelose"),this.gopherLose.anchor.x=.5,this.gopherLose.anchor.y=.5,this.gopherLose.kill();var j={font:"25px Arial",fill:"#ffffff",align:"center"};this.pause_label=this.game.add.text(BasicGame.w-100,0,"H:Help",j),this.pause_screen=this.game.add.sprite(BasicGame.w/2,BasicGame.h/2,"pause"),this.pause_screen.anchor.setTo(.5,.5),this.pause_screen.kill(),this.text1=this.game.add.text(BasicGame.w/4,BasicGame.h/2-100,"RUN: Hold the shift key.",j),this.text1.kill(),this.text2=this.game.add.text(BasicGame.w/4,BasicGame.h/2-60,"MOVE: Use arrow keys or w,a,s,d",j),this.text2.kill(),this.text3=this.game.add.text(BasicGame.w/4,BasicGame.h/2-20,"ARROWS: Press B to fire an Arrow.",j),this.text3.kill(),this.text4=this.game.add.text(BasicGame.w/4,BasicGame.h/2+20,"Harvest: Stand next to tree and INTERACT.",j),this.text4.kill(),this.text5=this.game.add.text(BasicGame.w/4,BasicGame.h/2+85,"Don't let the skunks catch you!",j),this.text5.kill(),this.text6=this.game.add.text(BasicGame.w/4,BasicGame.h/2+125,"Press H to Resume",j),this.text6.kill(),BasicGame.liveSprites=null,BasicGame.liveSprites=this.game.add.group();for(var i=0;i<BasicGame.lives;i++)BasicGame.liveSprites.create(22*i,0,"objects","lifesprite.png");this.woodText=this.game.add.text(12*tileSize,0,"Wood: "+BasicGame.wood,j),this.peltsText=this.game.add.text(26*tileSize,0,"Pelts: "+BasicGame.pelts,j),this.hud=this.game.add.sprite(0,0),this.hud.fixedToCamera=!0,this.hud.addChild(BasicGame.liveSprites),this.hud.addChild(this.woodText),this.hud.addChild(this.peltsText),this.hud.addChild(this.pause_label),this.game.device.desktop||(this.pause_label.kill(),this.hud.addChild(a),this.hud.addChild(b),this.hud.addChild(c),this.hud.addChild(d),this.hud.addChild(e),this.hud.addChild(f),this.hud.addChild(g),this.idevice||this.hud.addChild(h)),this.hud.cameraOffset.x=10,this.hud.cameraOffset.y=10},BasicGame.level5.prototype.update=function(){this.woodText.setText("Wood: "+BasicGame.wood),this.peltsText.setText("Pelts: "+BasicGame.pelts),player.sprite.alive&&this.game.time.events.onPlayerDeath.addOnce(this.loseLife,this),BasicGame.lives<=0&&this.game.state.start("restart"),dialogue.hidden&&(bKey.isDown||player.fire)&&!player.harvesting&&this.fire(),this.exitPoints.forEach(function(a){var b=a.getBounds(),c=player.sprite.getBounds();Phaser.Rectangle.intersects(b,c)&&(localStorage.setItem("playerX",player.sprite.x),localStorage.setItem("playerY",player.sprite.y),player.transfer=!0,this.game.time.events.onPlayerDeath.removeAll(),this.game.state.start(a.destination))},this),(spaceKey.isDown||player.interact)&&dialogue.hidden&&(BasicGame.haveAxe?BasicGame.finished?(BasicGame.checkpoint=4,localStorage.setItem("checkpoint","4"),this.updateCharacterLines(),this.stranger.interact()):(BasicGame.checkpoint=3,localStorage.setItem("checkpoint","3"),this.updateCharacterLines(),this.stranger.interact()):this.stranger.interact()&&(BasicGame.checkpoint=2,localStorage.setItem("checkpoint","2"),this.updateCharacterLines())),(spaceKey.isDown||player.interact)&&dialogue.hidden&&(this.tree3.harvested||this.tree3.interact(),this.tree4.harvested||this.tree4.interact()),!spaceKey.isDown&&!player.interact||dialogue.typing||dialogue.hidden||dialogue.hide(),player.update();for(var a=0;a<this.skunks.length;a++)this.skunks[a]&&(this.skunks[a].update(),BasicGame.skunkSpawns[this.skunks[a].skunkNum]&&Phaser.Rectangle.intersects(BasicGame.arrows.getBounds(),this.skunks[a].sprite.getBounds())&&(BasicGame.skunkSpawns[this.skunks[a].skunkNum]=!1,localStorage.setItem("skunkSpawns",JSON.stringify(BasicGame.skunkSpawns)),BasicGame.arrows.kill(),this.skunks[a].sprite.destroy(),this.skunks[a]=null,BasicGame.pelts++,localStorage.setItem("pelts",BasicGame.pelts)));this.npcs.sort("y",Phaser.Group.SORT_ASCENDING)},BasicGame.level5.prototype.loseLife=function(){BasicGame.liveSprites.getFirstAlive().kill(),player.diedToHole&&(player.diedToHole=!1,this.gopherLose.revive(),this.game.time.events.add(2*Phaser.Timer.SECOND,this.killGopherScreen,this)),this.game.time.events.add(2*Phaser.Timer.SECOND,this.createPlayer,this)},BasicGame.level5.prototype.killGopherScreen=function(){this.gopherLose.kill()},BasicGame.level5.prototype.createPlayer=function(){"level2"!==BasicGame.lastLocation&&"level5"!==BasicGame.lastLocation||(player.tilex=this.playerx,player.tiley=3*tileSize+2,player.transfer||null===player.sprite?player.create("sam08.png","down"):player.sprite.reset(player.tilex,player.tiley))},BasicGame.level5.prototype.fire=function(){if(this.game.time.now>BasicGame.arrowTime){switch(this.game.time.events.add(Phaser.Timer.SECOND,function(){BasicGame.arrows.kill()},this),player.sprite.direction){case"left":BasicGame.arrows.reset(player.sprite.x-20,player.sprite.y),BasicGame.arrows.body.angle=180,BasicGame.arrows.body.velocity.x=-400,BasicGame.arrows.body.velocity.y=0;break;case"right":BasicGame.arrows.reset(player.sprite.x+18,player.sprite.y),BasicGame.arrows.body.angle=0,BasicGame.arrows.body.velocity.x=400,BasicGame.arrows.body.velocity.y=0;break;case"up":BasicGame.arrows.reset(player.sprite.x,player.sprite.y-20),BasicGame.arrows.body.angle=-90,BasicGame.arrows.body.velocity.x=0,BasicGame.arrows.body.velocity.y=-400;break;case"down":BasicGame.arrows.reset(player.sprite.x,player.sprite.y+25),BasicGame.arrows.body.angle=90,BasicGame.arrows.body.velocity.x=0,BasicGame.arrows.body.velocity.y=400}BasicGame.arrowTime=this.game.time.now+1e3}},BasicGame.level5.prototype.updateCharacterLines=function(){this.updating||(this.updating=!0,this.stranger.script=this.lines.stranger[BasicGame.checkpoint].split("*"),this.stranger.spoke=!1,this.updating=!1)},BasicGame.level5.prototype.gofull=function(){this.game.scale.isFullScreen?this.game.scale.stopFullScreen():this.game.scale.startFullScreen(!1)},BasicGame.level5.prototype.togglePause=function(){this.game.paused=!this.game.paused,this.game.paused?(this.pause_screen.revive(),this.text1.revive(),this.text2.revive(),this.text3.revive(),this.text4.revive(),this.text5.revive(),this.text6.revive()):(this.pause_screen.kill(),this.text1.kill(),this.text2.kill(),this.text3.kill(),this.text4.kill(),this.text5.kill(),this.text6.kill())},BasicGame.level5.prototype.unpauseGame=function(a){this.game.paused&&this.togglePause()},window.onload=function(){var a=new Phaser.Game(BasicGame.w,BasicGame.h,Phaser.CANVAS);a.state.add("boot",BasicGame.Boot),a.state.add("preload",BasicGame.Preload),a.state.add("openscreen",BasicGame.Open),a.state.add("win",BasicGame.win),a.state.add("lose",BasicGame.lose),a.state.add("restart",BasicGame.restart),a.state.add("level1",BasicGame.level1),a.state.add("level2",BasicGame.level2),a.state.add("level3",BasicGame.level3),a.state.add("level4",BasicGame.level4),a.state.add("level5",BasicGame.level5),a.state.start("boot")};